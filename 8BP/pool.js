var shotInfo = {
  "basic": [
    {
      "tint": "grey",
      "desc": "Slightly too hard.",
      "target": [.58, .59],
      "cue":    [.30, .77],
      "gold":   [.36, .57]
    },
    {
      "tint": "gold",
      "desc": "As shown.",
      "target": [.45, .55],
      "cue":    [.75, .64],
      "gold":   [.69, .50]
    },
    {
      "tint": "red",
      "desc": [
        "Slightly too hard.",
        ""
      ],
      "target": [.38, .46],
      "cue":    [.65, .61],
      "gold":   [.61, .48]
    },
    {
      "tint": "gold",
      "desc": "As shown (very slightly too soft).",
      "target": [.64, .48],
      "cue":    [.30, .71],
      "gold":   [.34, .55]
    },
    {
      "tint": "red",
      "desc": [
        "Black section halfway over line?",
        "Barely too hard."
      ],
      "target": [.63, .67],
      "cue":    [.38, .34],
      "gold":   [.40, .45]
    },
    {
      "tint": "white",
      "desc": [
        "Add backspin to avoid double-kissing.",
        "Too soft."
      ],
      "target": [.57, .48],
      "cue":    [.75, .81],
      "gold":   [.74, .73]
    },
    {
      "tint": "cyan",
      "desc": [
        "Too soft.",
        ""
      ],
      "target": [.48, .65],
      "cue":    [.30, .34],
      "gold":   [.31, .43]
    },
    {
      "tint": "gold",
      "desc": "",
      "target": [.73, .51],
      "cue":    [.36, .67],
      "gold":   [.50, .63]
    },
    {
      "tint": "gold",
      "desc": "",
      "target": [.67, .53],
      "cue":    [.30, .47],
      "gold":   [.38, .63]
    },
    {
      "tint": "white",
      "desc": [
        "",
        ""
      ],
      "target": [.43, .62],
      "cue":    [.76, .75],
      "gold":   [.71, .61]
    },
    {
      "tint": "red",
      "desc": [
        "",
        ""
      ],
      "target": [.58, .71],
      "cue":    [.34, .41],
      "gold":   [.41, .35]
    },
    {
      "tint": "white",
      "desc": [
        "",
        ""
      ],
      "target": [.66, .67],
      "cue":    [.44, .43],
      "gold":   [.52, .39]
    },
    {
      "tint": "red",
      "desc": [
        "",
        ""
      ],
      "target": [.46, .49],
      "cue":    [.66, .76],
      "gold":   [.55, .78]
    },
    {
      "tint": "grey",
      "desc": [
        "",
        ""
      ],
      "target": [.58, .62],
      "cue":    [.75, .35],
      "gold":   [.74, .45]
    },
    {
      "tint": "grey",
      "desc": [
        "",
        ""
      ],
      "target": [.68, .55],
      "cue":    [.30, .69],
      "gold":   [.38, .50]
    }
  ],
  "chain": [
    {
      "tint": "red",
      "desc": [
        "Too soft.",
        ""
      ],
      "target": [.66, .55],
      "cue":    [.29, .52],
      "gold":   [.47, .43],
      "red":    [.37, .44]
    },
    {
      "tint": "grey",
      "desc": [
        "Far too hard, probably intended for force 1.",
        ""
      ],
      "target": [.72, .49],
      "cue":    [.38, .84],
      "gold":   [.53, .54],
      "red":    [.46, .66]
    },
    {
      "tint": "cyan",
      "desc": [
        "Slightly too soft.",
        ""
      ],
      "target": [.37, .69],
      "cue":    [.74, .41],
      "gold":   [.51, .45],
      "red":    [.62, .41]
    },
    {
      "tint": "gold",
      "desc": [
        "Hit between shown and 1/4 power.",
        "Shown power almost too hard."
      ],
      "target": [.34, .53],
      "cue":    [.70, .47],
      "gold":   [.55, .45],
      "red":    [.62, .45]
    },
    {
      "tint": "cyan",
      "desc": [
        "Too hard.",
        ""
      ],
      "target": [.68, .57],
      "cue":    [.34, .49],
      "gold":   [.50, .47],
      "red":    [.43, .46]
    },
    {
      "tint": "grey",
      "desc": [
        "Too hard (bounces).",
        ""
      ],
      "target": [.67, .65],
      "cue":    [.28, .58],
      "gold":   [.52, .68],
      "red":    [.35, .63]
    },
    {
      "tint": "cyan",
      "desc": [
        "Too soft, cut too far.",
        ""
      ],
      "target": [.52, .45],
      "cue":    [.79, .84],
      "gold":   [.72, .61],
      "red":    [.76, .71]
    },
    {
      "tint": "cyan",
      "desc": [
        "",
        ""
      ],
      "target": [.34, .52],
      "cue":    [.77, .60],
      "gold":   [.51, .67],
      "red":    [.62, .67]
    },
    {
      "tint": "gold",
      "desc": "",
      "target": [.69, .67],
      "cue":    [.35, .34],
      "gold":   [.55, .43],
      "red":    [.45, .36]
    },
    {
      "tint": "grey",
      "desc": [
        "Too soft, bad angle.",
        ""
      ],
      "target": [.34, .69],
      "cue":    [.77, .42],
      "gold":   [.58, .66],
      "red":    [.68, .58]
    },
    {
      "tint": "red",
      "desc": [
        "",
        ""
      ],
      "target": [.36, .56],
      "cue":    [.68, .62],
      "gold":   [.54, .65],
      "red":    [.61, .66]
    },
    {
      "tint": "grey",
      "desc": [
        "Cut far too much.",
        "Red barely hits gold."
      ],
      "target": [.58, .52],
      "cue":    [.29, .55],
      "gold":   [.40, .49],
      "red":    [.36, .51]
    },
    {
      "tint": "grey",
      "desc": [
        "",
        ""
      ],
      "target": [.51, .70],
      "cue":    [.25, .31],
      "gold":   [.32, .54],
      "red":    [.28, .43]
    },
    {
      "tint": "gold",
      "desc": [
        "",
        ""
      ],
      "target": [.54, .69],
      "cue":    [.79, .29],
      "gold":   [.67, .39],
      "red":    [.73, .33]
    }
  ],
  "rebound": [
    {
      "tint": "gold",
      "desc": [
        "Aim with high aim level queue to line up, align battered cue to blue/white border on table cushion.",
        "Almost too soft, aim for 1/3rd of black segment below line."
      ],
      "target": [.51, .66],
      "cue":    [.50, .36],
      "gold":   [.35, .39]
    },
    {
      "tint": "cyan",
      "desc": [
        "On target, too hard.",
        "End result of A.",
        "Off target, too soft.",
        "End result of C."
      ],
      "target": [.34, .67],
      "cue":    [.33, .35],
      "gold":   [.57, .35]
    },
    {
      "tint": "grey",
      "desc": [
        "On target, far too hard.",
        ""
      ],
      "target": [.47, .69],
      "cue":    [.68, .46],
      "gold":   [.56, .43]
    },
    {
      "tint": "grey",
      "desc": [
        "On target, do not adjust aim.",
        "Far too hard."
      ],
      "target": [.36, .64],
      "cue":    [.48, .42],
      "gold":   [.62, .45]
    },
    {
      "tint": "gold",
      "desc": [
        "",
        ""
      ],
      "target": [.69, .69],
      "cue":    [.71, .38],
      "gold":   [.48, .40]
    }
  ]
};

function getPos(e) {
  var posX = ((e.x - e.currentTarget.x) / e.currentTarget.clientWidth);
  var posY = ((e.y - e.currentTarget.y) / e.currentTarget.clientHeight);
  //alert("x: " + posX + "\ny: " + posY);
  return [posX, posY];
}

function shotSort(a, b) {
  if (a.target[0] < b.target[0]) return -1;
  if (a.target[0] > b.target[0]) return 1;
  return 0;
}

function iterateShots(data, type) {
  data.forEach((shot, i) => { shot.imageID = i+1; });
  var sortedData = data.sort(shotSort);
  sortedData.forEach((shot, i) => {
    var name = type + " " + shot.imageID;
    var shotHtml = buildShot(shot, name);

    var shotObj = document.createElement("div");
    shotObj.id = name;
    shotObj.innerHTML = shotHtml[0];
    shotObj.style.display = "none";
    document.getElementById("shots").appendChild(shotObj);

    var shotToggle = document.createElement("button");
    shotToggle.innerHTML = "<h4>" + name + "</h4>" + shotHtml[1];
    shotToggle.type = "button";
    shotToggle.onclick = function() { toggleVisible(shotObj) };
    shotToggle.style = "width: 10%; background: " + shot.tint;
    document.getElementById("toggles").appendChild(shotToggle);
  });
}

function buildShot(data, name) {
  var images = [];
  if (typeof data.desc == "string") {
    images.push([name, data.desc]);
  }
  else data.desc.forEach((str, i) => {
    if (str == "") images.push([name + String.fromCharCode(65 + i), ""]);
    else images.push([name + String.fromCharCode(65 + i), String.fromCharCode(65 + i) + ": " + str]);
  });
  var resp = "<h3>" + name + "</h3><div style='display: flex; flex-wrap: wrap'>";
  var firstImg = "<img src='./" + images[0][0] + ".png' width=100% />";
  images.forEach(img => {
    resp += "<div style='flex-basis:50%; margin-top: 20px'><img src='./" + img[0] + ".png' width=100% onclick='getPos(event)' /><br/>";
    if (img[1] == "") resp += "</div>";
    else resp += "<span style='margin-left: 40px'>" + img[1] + "</span></div>";
  });
  return [resp + "</div>", firstImg];
}

var curVisible = null;
function toggleVisible(div) {
  if (curVisible != null) curVisible.style.display = "none";
  curVisible = div;
  div.style.display = null;
}

window.onload = function () {
  var toggles = document.getElementById("toggles");
  iterateShots(shotInfo.basic, "Basic");
  var br = document.createElement("br");
  toggles.appendChild(br);
  iterateShots(shotInfo.chain, "Chain");
  br = document.createElement("br");
  toggles.appendChild(br);
  iterateShots(shotInfo.rebound, "Rebound");
}
